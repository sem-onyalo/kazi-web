Config={API_URL:"https://sheltered-island-31823.herokuapp.com"},Constants={ADD_COMPONENT_ELEM_ID_PREFIX:"addComponent",ADD_COMPONENT_RESULT_MESSAGE_ELEM_ID_PREFIX:"addComponentResultMessage",ADD_TASK_ELEM_ID:"addTaskInput",ADD_TASK_MAX_LENGTH:255,ALERT_ELEM_ID:"alertElement",ASSOCIATION_KEY_ATTRIBUTE:"association-key",ASSOCIATION_LIST_ELEM_ID:"associationsList",ASSOCIATION_LIST_CONTAINER_ELEM_ID:"associationsContainer",ASSOCIATION_CONTENT_CONTAINER_ELEM_ID:"associationContent",ASSOCIATION_VIEW_ELEM_ID:"associationView",AUTHORIZATION_REQUIRED_RESPONSE:"Authorization Required",COMPONENT_CONTAINER_ELEM_ID:"componentsContainer",COMPONENT_ITEM_ELEM_ID_PREFIX:"componentItem",COMPONENT_TASK_LIST_ITEM_ELEM_ID_PREFIX:"componentTaskListItem",COMPONENT_TASK_ITEM_ELEM_ID_PREFIX:"componentTaskItem",COMPONENT_ID_ATTRIBUTE:"component-id",COMPONENT_KEY_ATTRIBUTE:"component-key",COMPONENTS_LOADED_ATTRIBUTE:"components-loaded",CURRENT_ASSOCIATION_ID_ELEM_ID:"currentAssociationId",CURRENT_DIRECTORY_ID_ELEM_ID:"currentDirectoryId",DIRECTORIES_CONTAINER_ELEM_ID:"directoriesContainer",DIRECTORY_ID_ATTRIBUTE:"directory-id",DROPDOWN_ELEM_ID:"navbarDropdown",EDIT_TASK_ELEM_ID_PREFIX:"editTaskInput",ENTER_KEYCODE:13,ITEM_ID_ATTRIBUTE:"item-id",LOADING_COMPONENT_LIST_ELEM_ID:"loadingComponentList",LOADING_COMPONENTS_ELEM_ID:"loadingComponents",LOADING_DIRECTORIES_ELEM_ID:"loadingDirectories",LOADING_ROOT_ELEM_ID:"loadingRoot",LOADING_SIGN_IN_ELEM_ID:"loadingSignIn",LOADING_TASKS_LIST_ELEM_ID:"loadingTasksList",LOADING_TASK_COMPONENT_ELEM_ID:"loadingTaskComponent",LOADING_TASK_COMPONENTS_ELEM_ID:"loadingTaskComponents",MAP_API_KEY:"AIzaSyAgISl38x3fEnLXxn_2VYumF9b9RsPFVHQ",MAP_URL:"https://www.google.com/maps/embed/v1/place?key=AIzaSyAgISl38x3fEnLXxn_2VYumF9b9RsPFVHQ",MESSAGE_ID_ATTRIBUTE:"message-id",NAVBAR_ELEM_ID:"navbar",NAVBAR_COMPONENTS_CONTAINER_ELEM_ID:"navbarComponents",NO_TASKS_ELEM_ID:"noTasksMessage",SIGN_IN_ELEM_ID:"signInContainer",SIGN_IN_ERROR_ELEM_ID:"signInError",SIGN_IN_FORM_ELEM_ID:"signInForm",SIGN_IN_PASSWORD_ELEM_ID:"inputPassword",SIGN_IN_USERNAME_ELEM_ID:"inputUsername",SIGN_OUT_ELEM_ID:"signOutContainer",TASK_COMPONENTS_CONTAINER_ELEM_ID_PREFIX:"taskComponentsContainer",TASK_COMPONENTS_TOGGLE_ELEM_ID:"taskComponentsToggle",TASK_CONTAINER_ELEM_ID:"taskContainer",TASK_ELEM_ID_PREFIX:"taskItem",TASK_ID_ATTRIBUTE:"task-id",TASK_LIST_ELEM_ID:"taskList",UPDATE_TASK_NAME_REQUIRED_ELEM_ID_PREFIX:"updateTaskNameRequired",USER_ID_ATTRIBUTE:"user-id",ComponentType:{TASK_ADDON:1,TASK_LIST:2},CssClass:{BUTTON_COMPONENT_DEFAULT:"btn-component_default",COMPONENT_HEADER:"component-header",COMPONENT_ITEM:"component-item",COMPONENT_SUCCESS_MESSAGE:"component-success-message",COMPONENTS_EXPANDED:"components-expanded",FORM_CONTROL_DEFAULT:"form-control-default",INLINE_ACTION_RESULT_MESSAGE_FAILURE:"inline-action-result-message red",INLINE_ACTION_RESULT_MESSAGE_SUCCESS:"inline-action-result-message green",LOAD_TASK_COMPONENTS:"load-task-components",GREEN:"green",ITEM_LIST_COMPONENT:"item-list-component",RED:"red",SIDEBAR_HEADER:"sidebar-header",TASK_ITEM:"task-item",TASK_LIST:"tasks-container",TASK_LIST_MESSAGE:"item-list-message"},UserRole:{SUPERADMIN:1,ADMIN:2,USER:3}},Resources={ADD_A_TASK:"Add a cazzie",ADD_COMPONENT_TO_CURRENT_DIRECTORY:"Add component to current directory",ADDED_EXCL:"Added!",COMPONENTS_HEADER:"Components",ERROR_ADDING_ITEM:"There was an error while trying to add your game",ERROR_LOADING_COMPONENTS:"There as an error while trying to load your components",ERROR_LOADING_DIRECTORIES:"There was an error while trying to load your folders",ERROR_LOADING_GAMES:"There was an error while trying to load your games",ERROR_LOADING_PAGE:"There was an error while trying to load this page",ERROR_LOADING_TASK_COMPONENT:"Error loading component data",FOLDERS_HEADER:"Folders",INVALID_PAGE:"The page you requested is invalid",INVALID_SIGNIN_CREDENTIALS:"Your username or password was invalid",LOADING_ASSOCIATIONS:"Loading your associations...",LOADING_DIRECTORIES:"Loading folders...",LOADING_TASKS:"Loading cazzies...",NEW_GAME:"New game",NO_GAMES_TO_LOAD:"No games yet...",NO_TASKS_TO_LOAD:"No cazzies yet...",PASSWORD:"Password",PASSWORD_IS_REQUIRED:"Your password is required",SAVED_SUCCESSFULLY:"Saved successfully!",SIGN_IN:"Sign in",SIGN_OUT:"Sign out",SIGN_IN_HEADER:"Sign In",TASK_NAME_IS_REQUIRED:"A value is required",UNKNOWN_SIGNIN_ERROR:"There was an error while trying to sign you in",USERNAME:"Username",USERNAME_IS_REQUIRED:"Your username is required"},GenericHelper={newGuid:function(){return Math.random().toString(36).substring(2)+(new Date).getTime().toString(36)}},AjaxHelper={getJsonRequest:function(e){this.request({url:e.url,method:"GET",contentType:"application/json",callback:e.callback,callbackArgs:e.callbackArgs})},postJsonRequest:function(e){this.request({url:e.url,method:"POST",contentType:"application/json",content:e.content?JSON.stringify(e.content):"",callback:e.callback,callbackArgs:e.callbackArgs})},putJsonRequest:function(e){this.request({url:e.url,method:"PUT",contentType:"application/json",content:JSON.stringify(e.content),callback:e.callback,callbackArgs:e.callbackArgs})},getRequest:function(e){this.request({url:e.url,method:"GET",callback:e.callback,callbackArgs:e.callbackArgs})},request:function(e){var t=new XMLHttpRequest;if("withCredentials"in t||(t=new XDomainRequest),!t)return!1;t.onreadystatechange=function(){AjaxHelper.response(t,e.callback,e.callbackArgs)},t.open(e.method,e.url),t.withCredentials=!0,e.contentType&&t.setRequestHeader("Content-Type",e.contentType),e.authorization&&t.setRequestHeader("Authorization",e.authorization),t.send(e.content)},response:function(e,t,n){e.readyState===XMLHttpRequest.DONE&&t&&(200===e.status?t(e.responseText,n):t('{ "status": '+e.status+', "message": "'+e.responseText+'" }',n))}},ElementHelper={cancelActiveElementDelegates:[],addLoadingElement:function(e,t){this.appendChildElement({parentElement:"string"==typeof e?document.getElementById(e):e,childElement:this.createLoadingElement(t)})},appendChildElement:function(e){var t;e.childElement?t=e.childElement:((t=document.createElement(e.childElementType)).id=e.childElementId?e.childElementId:"",t.innerHTML=e.childElementText,t.className=e.childElementClass?e.childElementClass:""),(e.parentElement?e.parentElement:document.getElementById(e.parentElementId)).appendChild(t)},appendHyperlinkedChildElement:function(e){var t=document.createElement(e.childElementType);t.className=e.childElementClass?e.childElementClass:"";var n=document.createElement("a");n.href=e.link,n.innerHTML=e.childElementText,n.className=e.linkElementClass?e.linkElementClass:"",t.appendChild(n),e.parentElement.appendChild(t)},cancelActiveElements:function(){for(;this.cancelActiveElementDelegates.length>0;)this.cancelActiveElementDelegates.pop()()},clearChildElements:function(e){for(;e.parentElement.lastChild;)this.removeChildElement({parentElement:e.parentElement,childElement:e.parentElement.lastChild})},clearSelectOptions:function(e){for(var t=e.parentElement.options.length-1;t>=0;t--)e.parentElement.remove(t)},createErrorMessageElement:function(e){var t=document.createElement("span");return t.id=e.elementId,t.className=Constants.CssClass.RED,t.innerHTML=e.message,t},createIconElement:function(e,t){var n=document.createElement("i");return n.className="fa fa-"+e,t&&(n.className+=" "+t),n},createInputElement:function(e){var t=document.createElement("input");if(t.id=e.elementId,t.type=e.elementType,t.className=e.elementClass?e.elementClass:"",t.value=e.elementValue?e.elementValue:"",e.elementAttributes)for(var n=0;n<e.elementAttributes.length;n++)t.setAttribute(e.elementAttributes[n][0],e.elementAttributes[n][1]);return t},createLoadingElement:function(e){var t=document.createElement("div"),n=document.createElement("span"),a=document.createElement("img");return a.src="assets/loading.svg",t.id=e||"loadingElement",t.className="loading-container",t.appendChild(n),t.appendChild(a),t},createTextInputElement:function(e){return this.createInputElement({elementId:e.elementId,elementType:"text",elementClass:e.elementClass,elementValue:e.elementValue,elementAttributes:e.elementAttributes})},findParentElementByClassName:function(e,t){for(;(e=e.parentElement)&&!e.classList.contains(t););return e},prependChildElement:function(e){if(!(e.childElement&&document.getElementById(e.childElement.id)||e.childElementId&&document.getElementById(e.childElementId))){var t;if(e.childElement)t=e.childElement;else if(t=document.createElement(e.childElementType),t.id=e.childElementId?e.childElementId:"",t.innerHTML=e.childElementText,t.className=e.childElementClass?e.childElementClass:"",e.childElementAttributes)for(var n=0;n<e.childElementAttributes.length;n++)t.setAttribute(e.childElementAttributes[n][0],e.childElementAttributes[n][1]);var a=e.parentElement?e.parentElement:document.getElementById(e.parentElementId);a.insertBefore(t,a.firstChild)}},removeChildElement:function(e){var t=e.childElement?e.childElement:document.getElementById(e.childElementId),n=e.parentElement?e.parentElement:document.getElementById(e.parentElementId);t&&n.removeChild(t)},removeLoadingElement:function(e,t){this.removeChildElement({parentElement:"string"==typeof e?document.getElementById(e):e,childElementId:t})},replaceChildElement:function(e){var t=e.childElement?e.childElement:document.getElementById(e.childElementId),n=e.parentElement?e.parentElement:document.getElementById(e.parentElementId);n&&t&&e.newElement&&n.replaceChild(e.newElement,t)}},EventHelper={isEnter:function(e){return 13===e.which||13===e.keyCode},isEsc:function(e){return 27===e.which||27===e.keyCode},resizeEventHandlers:{}},UrlHelper={init:function(e){this.routes={},this.routes.list=e.split("/").slice(3),this.routes.has=function(e){return this.list.length>0&&e===Constants.ASSOCIATION_KEY_ATTRIBUTE},this.routes.get=function(e){if(this.list.length>0&&e===Constants.ASSOCIATION_KEY_ATTRIBUTE)return this.list[0]}}},UserInteractor={init:function(){var e=document.createElement("button");e.type="button",e.className="btn btn-primary",e.innerHTML=Resources.SIGN_IN,e.onclick=this.signInBtnEventHandler,document.getElementById("signInFooter").appendChild(e),document.getElementById("inputUsername").onkeypress=this.signInInputEventHandler,document.getElementById("inputPassword").onkeypress=this.signInInputEventHandler},getUserSession:function(){if(sessionStorage.user)return JSON.parse(sessionStorage.user)},setUserSession:function(e){sessionStorage.user=JSON.stringify(e)},expireUserSession:function(e){AjaxHelper.getRequest({url:Config.API_URL+"/users/expire",callback:function(){delete sessionStorage.user,document.dispatchEvent(new CustomEvent("onsignout"))}})},authenticateUser:function(){$("#signInForm").modal({backdrop:"static",keyboard:!1,show:!0})},authenticateUserRequest:function(e){this.validateUsername(e.usernameElem)&&this.validatePassword(e.passwordElem)&&(ElementHelper.addLoadingElement(Constants.SIGN_IN_FORM_ELEM_ID,Constants.LOADING_SIGN_IN_ELEM_ID),AjaxHelper.postJsonRequest({url:Config.API_URL+"/users/authenticate",content:{Username:e.usernameElem.value,Password:e.passwordElem.value},callback:this.authenticateUserRequestCallback}))},authenticateUserRequestCallback:function(e,t){ElementHelper.removeLoadingElement(Constants.SIGN_IN_FORM_ELEM_ID,Constants.LOADING_SIGN_IN_ELEM_ID);var n=JSON.parse(e);if(n.status&&200!==n.status){if(!document.getElementById(Constants.SIGN_IN_ERROR_ELEM_ID)){var a=n.message===Constants.AUTHORIZATION_REQUIRED_RESPONSE?Resources.INVALID_SIGNIN_CREDENTIALS:Resources.UNKNOWN_SIGNIN_ERROR,o=document.getElementById("signInHeader");o.insertBefore(ElementHelper.createErrorMessageElement({elementId:Constants.SIGN_IN_ERROR_ELEM_ID,message:a}),o.lastChild.nextSibling)}}else UserInteractor.setUserSession(n),document.dispatchEvent(new CustomEvent("onsignin")),ElementHelper.removeChildElement({parentElementId:"signInHeader",childElementId:Constants.SIGN_IN_ERROR_ELEM_ID}),$("#signInForm").modal("hide")},validateUsername:function(e){if(""===e.value.trim()){if("usernameRequired"!==e.previousSibling.id){var t=document.createElement("span");t.id="usernameRequired",t.className=Constants.CssClass.RED,t.innerHTML=Resources.USERNAME_IS_REQUIRED,e.parentElement.insertBefore(t,e)}return!1}return"usernameRequired"===e.previousSibling.id&&e.parentElement.removeChild(e.previousSibling),!0},validatePassword:function(e){if(""===e.value.trim()){if("passwordRequired"!==e.previousSibling.id){var t=document.createElement("span");t.id="passwordRequired",t.className=Constants.CssClass.RED,t.innerHTML=Resources.PASSWORD_IS_REQUIRED,e.parentElement.insertBefore(t,e)}return!1}return"passwordRequired"===e.previousSibling.id&&e.parentElement.removeChild(e.previousSibling),!0},signInBtnEventHandler:function(e){var t=document.getElementById(Constants.SIGN_IN_USERNAME_ELEM_ID),n=document.getElementById(Constants.SIGN_IN_PASSWORD_ELEM_ID);UserInteractor.authenticateUserRequest({usernameElem:t,passwordElem:n})},signInInputEventHandler:function(e){if(EventHelper.isEnter(e)){var t=document.getElementById(Constants.SIGN_IN_USERNAME_ELEM_ID),n=document.getElementById(Constants.SIGN_IN_PASSWORD_ELEM_ID);UserInteractor.authenticateUserRequest({usernameElem:t,passwordElem:n})}}},BaseComponentInteractor={createComponentElement:function(e){switch(e.componentType){case Constants.ComponentType.TASK_ADDON:return this.createItemAddonComponentElement(e);case Constants.ComponentType.TASK_LIST:return this.createItemListComponentElement(e);default:return}},createItemAddonComponentElement:function(e){if(e.bodyElement){var t=document.createElement("hr"),n=document.createElement("div");n.className=Constants.CssClass.COMPONENT_HEADER,n.appendChild(e.headerTextElement),n.appendChild(t);var a=document.createElement("div");if(a.className="component-action",e.isSettings){var o=ElementHelper.createIconElement("cog");o.onclick=this.settingsClickEventHandler,a.appendChild(o)}var s=document.createElement("div");s.className="row",s.appendChild(n),s.appendChild(a);var r=document.createElement("div");r.className="component-body",r.classList.add(e.key),r.appendChild(e.bodyElement);var l=document.createElement("div");return l.className="component-container",l.setAttribute(Constants.TASK_ID_ATTRIBUTE,e.itemId),l.setAttribute(Constants.COMPONENT_ID_ATTRIBUTE,e.componentData&&e.componentData.id?e.componentData.id:0),l.appendChild(s),l.appendChild(r),l}},createItemListComponentElement:function(e){if(e.bodyElement){var t=document.createElement("div");return t.className="component-body",t.classList.add(e.key),t.appendChild(e.bodyElement),t}},addOrUpdateComponentBodyElement:function(e,t,n){t?ElementHelper.replaceChildElement({parentElement:t.parentElement,childElement:t,newElement:n}):e.getElementsByClassName("component-body")[0].appendChild(n)},displayRequestActionResultMessage:function(e){var t=document.createElement("div"),n=GenericHelper.newGuid();t.id=n,t.innerHTML=e.message,t.className=e.isSuccess?Constants.CssClass.GREEN:Constants.CssClass.RED,e.parentElement.appendChild(t),setTimeout(function(){ElementHelper.removeChildElement({parentElement:e.parentElement,childElement:t})},4e3)},settingsClickEventHandler:function(e){var t=ElementHelper.findParentElementByClassName(e.target,"component-container").getElementsByClassName("component-settings")[0];""===t.style.display?$(t).slideUp():$(t).slideDown()}},ComponentInteractor={components:{event:{key:"event",init:function(e){},createComponentElement:function(e){var t=document.createElement("span");return t.innerHTML="Game Time",t.className="component-header-text",BaseComponentInteractor.createComponentElement({isSettings:!0,key:this.key,itemId:e.itemId,componentData:e.componentData,componentType:e.componentType,headerTextElement:t,bodyElement:this.createBodyElement(e)})},createBodyElement:function(e){var t=document.createElement("div");t.className="component-body";var n=this.createSettingsElement(e);if(t.appendChild(n),e.componentData.data&&e.componentData.data.EventDate&&e.componentData.data.EventTime){n.style.display="none";var a=this.createDateTimeElement(e.componentData.data.EventDate,e.componentData.data.EventTime);t.appendChild(a)}return t},createSettingsElement:function(e){var t=document.createElement("input");t.type="text",t.className="form-control add-item",t.placeholder=this.Resources.EVENT_DATE,t.value=e.componentData.data&&e.componentData.data.EventDate?e.componentData.data.EventDate:"",t.onkeypress=this.dateTimeKeyPressEventHandler,$(t).datepicker({format:"yyyy-mm-dd"});var n=document.createElement("input");n.type="text",n.className="form-control add-item",n.placeholder=this.Resources.EVENT_TIME,n.value=e.componentData.data&&e.componentData.data.EventTime?e.componentData.data.EventTime:"",n.onkeypress=this.dateTimeKeyPressEventHandler,$(n).timepicker({timeFormat:"h:i A"});var a=document.createElement("div");a.className="col-xs-6",a.appendChild(t);var o=document.createElement("div");o.className="col-xs-6",o.appendChild(n);var s=document.createElement("div");return s.className="row component-settings",s.appendChild(a),s.appendChild(o),s},createDateTimeElement:function(e,t){var n=new Date(e+" "+t),a=document.createElement("div");return a.className="event-date-time",a.innerHTML=n.toDateString()+" @ "+n.toLocaleTimeString(),a},addOrUpdateDateTime:function(e){if(""!==e.dateElement.value.trim()&&""!==e.timeElement.value.trim()){var t=e.componentContainer.getAttribute(Constants.TASK_ID_ATTRIBUTE),n=e.componentContainer.getAttribute(Constants.COMPONENT_ID_ATTRIBUTE);AjaxHelper.postJsonRequest({url:Config.API_URL+"/tasks/"+t+"/components",content:{ComponentId:n,Data:{EventDate:e.dateElement.value,EventTime:e.timeElement.value}},callbackArgs:{componentContainer:e.componentContainer},callback:function(e,t){var n=JSON.parse(e);if(n.status&&"OK"===n.status){var a=t.componentContainer.getElementsByClassName("event-date-time")[0],o=ComponentInteractor.components.event.createDateTimeElement(n.Data.Data.EventDate,n.Data.Data.EventTime);BaseComponentInteractor.addOrUpdateComponentBodyElement(t.componentContainer,a,o);var s=t.componentContainer.getElementsByClassName("component-settings")[0];$(s).slideUp(),BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components.event.Resources.EVENT_DATETIME_SAVED,isSuccess:!0})}else BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components.event.Resources.EVENT_DATETIME_SAVE_ERROR,isSuccess:!1})}})}},dateTimeKeyPressEventHandler:function(e){if(EventHelper.isEnter(e)){var t=ElementHelper.findParentElementByClassName(e.target,"component-container"),n=t.getElementsByTagName("input")[0],a=t.getElementsByTagName("input")[1];ComponentInteractor.components.event.addOrUpdateDateTime({dateElement:n,timeElement:a,componentContainer:t})}},Resources:{EVENT:"Event",EVENT_DATE:"Game date...",EVENT_DATETIME_SAVED:"Saved!",EVENT_DATETIME_SAVE_ERROR:"There was an error saving your date/time",EVENT_TIME:"Game time...",NO_DATE_TIME_YET:"No date/time yet..."}},attendance:{key:"attendance",init:function(e){},createComponentElement:function(e){var t=document.createElement("span");return t.innerHTML="Attendance",BaseComponentInteractor.createComponentElement({key:this.key,itemId:e.itemId,componentData:e.componentData,componentType:e.componentType,headerTextElement:t,bodyElement:this.createBodyElement(e)})},createBodyElement:function(e){var t=document.createElement("div"),n=UserInteractor.getUserSession(),a="userAttendance"+e.itemId,o=document.createElement("input");o.id=a,o.type="checkbox",o.value="None",o.onclick=this.isAttendingClickEventHandler;var s=document.createElement("label");s.htmlFor=a,s.innerHTML=n.FirstName+" "+n.LastName;var r=document.createElement("div");r.className="row current-user",r.appendChild(o),r.appendChild(s),t.appendChild(r);var l=e.componentData.data,i=document.createElement("div");i.className="row";for(var m=0;m<l.length;m++)if(l[m].UserId!==n.Id){var c=ElementHelper.createIconElement(l[m].IsAttending?"check":"times"),d=document.createElement("span");d.innerHTML=l[m].FirstName+" "+l[m].LastName;var E=document.createElement("div");E.className="col-xs-6 col-sm-3 col-md-2",E.appendChild(c),E.appendChild(d),i.appendChild(E)}else o.checked=l[m].IsAttending;return t.appendChild(i),t},addOrUpdateIsAttending:function(e){var t=UserInteractor.getUserSession(),n=e.componentContainer.getAttribute(Constants.TASK_ID_ATTRIBUTE),a=e.componentContainer.getAttribute(Constants.COMPONENT_ID_ATTRIBUTE);AjaxHelper.postJsonRequest({url:Config.API_URL+"/tasks/"+n+"/components",content:{ComponentId:a,Data:{UserId:t.Id,IsAttending:e.isAttendingElement.checked}},callbackArgs:{isAttending:e.isAttendingElement.checked,componentContainer:e.componentContainer},callback:function(e,t){var n="attendance",a=JSON.parse(e);a.status&&"OK"===a.status?BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:t.isAttending?ComponentInteractor.components[n].Resources.ATTENDANCE_CONFIRMED:ComponentInteractor.components[n].Resources.ATTENDANCE_UNCONFIRMED,isSuccess:!0}):BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:t.isAttending?ComponentInteractor.components[n].Resources.ATTENDANCE_CONFIRM_ERROR:ComponentInteractor.components[n].Resources.ATTENDANCE_UNCONFIRM_ERROR,isSuccess:!1})}})},isAttendingClickEventHandler:function(e){var t=ElementHelper.findParentElementByClassName(e.target,"component-container");ComponentInteractor.components.attendance.addOrUpdateIsAttending({isAttendingElement:e.target,componentContainer:t})},Resources:{ATTENDANCE:"Attendance",ATTENDANCE_CONFIRM_ERROR:"An error occurred while confirming your attendance",ATTENDANCE_CONFIRMED:"Your attendance has been confirmed",ATTENDANCE_UNCONFIRM_ERROR:"An error occurred while confirming your absence",ATTENDANCE_UNCONFIRMED:"Your absence has been confirmed"}},location:{key:"location",init:function(e){},createComponentElement:function(e){var t=document.createElement("span");return t.innerHTML="Location",BaseComponentInteractor.createComponentElement({isSettings:!0,key:this.key,itemId:e.itemId,componentData:e.componentData,componentType:e.componentType,headerTextElement:t,bodyElement:this.createBodyElement(e)})},createBodyElement:function(e){var t=document.createElement("div");t.className="component-body";var n=this.createSettingsElement(e);return t.appendChild(n),e.componentData.data&&e.componentData.data.Location&&(n.style.display="none",t.appendChild(this.createLocationMapElement(e.componentData.data.Location))),t},createSettingsElement:function(e){var t=document.createElement("input");t.type="text",t.className="form-control add-item",t.placeholder=this.Resources.ENTER_LOCATION,t.value=e.componentData.data&&e.componentData.data.Location?e.componentData.data.Location:"",t.onkeypress=this.locationInputKeyPressEventHandler;var n=document.createElement("div");n.className="col-md-12",n.appendChild(t);var a=document.createElement("div");return a.className="row component-settings",a.appendChild(n),a},createLocationMapElement:function(e){var t=document.createElement("iframe");return t.frameBorder=0,t.marginWidth=0,t.marginHeight=0,t.scrolling="no",t.innerHTML="Loading...",t.className="location-map",t.src=Constants.MAP_URL+"&q="+e.replace(" ","+"),t},addOrUpdateLocation:function(e){if(""!==e.locationElement.value.trim()){var t=e.componentContainer.getAttribute(Constants.TASK_ID_ATTRIBUTE),n=e.componentContainer.getAttribute(Constants.COMPONENT_ID_ATTRIBUTE);AjaxHelper.postJsonRequest({url:Config.API_URL+"/tasks/"+t+"/components",content:{ComponentId:n,Data:{Location:e.locationElement.value}},callbackArgs:{componentContainer:e.componentContainer},callback:function(e,t){var n="location",a=JSON.parse(e);if(a.status&&"OK"===a.status){var o=t.componentContainer.getElementsByClassName("location-map")[0],s=ComponentInteractor.components[n].createLocationMapElement(a.Data.Data.Location);BaseComponentInteractor.addOrUpdateComponentBodyElement(t.componentContainer,o,s);var r=t.componentContainer.getElementsByClassName("component-settings")[0];$(r).slideUp(),BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components[n].Resources.LOCATION_SAVED,isSuccess:!0})}else BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components[n].Resources.LOCATION_SAVE_ERROR,isSuccess:!1})}})}},locationInputKeyPressEventHandler:function(e){if(EventHelper.isEnter(e)){var t=ElementHelper.findParentElementByClassName(e.target,"component-container"),n=t.getElementsByTagName("input")[0];ComponentInteractor.components.location.addOrUpdateLocation({locationElement:n,componentContainer:t})}},Resources:{ADD_UPDATE_LOCATION:"Add or update location",ENTER_LOCATION:"Enter location...",LOCATION:"Location",LOCATION_SAVED:"Location saved!",LOCATION_SAVE_ERROR:"There was an error saving your location",NO_LOCATION_YET:"No location yet..."}},messaging:{key:"messaging",intervals:[],init:function(e){document.addEventListener("onsignout",this.onSignOutEventHandler)},createComponentElement:function(e){var t=document.createElement("span");return t.innerHTML="Messages",BaseComponentInteractor.createComponentElement({key:this.key,itemId:e.itemId,componentData:e.componentData,componentType:e.componentType,headerTextElement:t,bodyElement:this.createBodyElement(e)})},createBodyElement:function(e){var t=this.createAddMessageElement(e),n=document.createElement("div");if(n.className="messages-container",e.componentData.data&&e.componentData.data.length>0)for(var a=e.componentData.data,o=0;o<a.length;o++){var s=this.createMessageElement(a[o]);ElementHelper.prependChildElement({parentElement:n,childElement:s})}var r=document.createElement("div");return r.className="component-body",r.appendChild(t),r.appendChild(n),r},createAddMessageElement:function(e){var t=document.createElement("input");t.type="text",t.className="form-control add-item",t.placeholder=this.Resources.MESSAGE,t.onkeypress=this.messageInputKeyPressEventHandler;var n=document.createElement("div");n.className="col-md-12",n.appendChild(t);var a=document.createElement("div");return a.className="row component-settings",a.appendChild(n),a},createMessageElement:function(e){var t=document.createElement("span");t.className="user",t.innerHTML=e.FirstName+" "+e.LastName;var n=new Date(e.CreateTimestamp),a=document.createElement("span");a.className="date-time",a.innerHTML=n.toDateString()+" @ "+n.toLocaleTimeString();var o=document.createElement("div");o.className="message",o.innerHTML=e.Message;var s=document.createElement("div");return s.className="message-container",s.setAttribute(Constants.MESSAGE_ID_ATTRIBUTE,e.Id),s.appendChild(t),s.appendChild(a),s.appendChild(o),s},addMessage:function(e){if(""!==e.messageInput.value.trim()){var t=UserInteractor.getUserSession(),n=e.componentContainer.getAttribute(Constants.TASK_ID_ATTRIBUTE),a=e.componentContainer.getAttribute(Constants.COMPONENT_ID_ATTRIBUTE);AjaxHelper.postJsonRequest({url:Config.API_URL+"/tasks/"+n+"/components",content:{ComponentId:a,Data:{UserId:t.Id,Message:e.messageInput.value.trim()}},callbackArgs:{componentContainer:e.componentContainer},callback:function(e,t){var n=JSON.parse(e);if(n.status&&"OK"===n.status){var a=t.componentContainer.getElementsByClassName("messages-container")[0],o=ComponentInteractor.components.messaging.createMessageElement(n.Data.Data);ElementHelper.prependChildElement({parentElement:a,childElement:o}),t.componentContainer.getElementsByTagName("input")[0].value=""}else BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components.messaging.Resources.ERROR_SAVING_MESSAGE,isSuccess:!1})}})}},getNewMessages:function(e){var t=setInterval(function(){var t=e.componentContainer.getAttribute(Constants.TASK_ID_ATTRIBUTE),n=e.componentContainer.getAttribute(Constants.COMPONENT_ID_ATTRIBUTE),a=e.componentContainer.getElementsByClassName("message-container")[0],o=a?parseInt(a.getAttribute(Constants.MESSAGE_ID_ATTRIBUTE)):0;AjaxHelper.getJsonRequest({url:Config.API_URL+"/tasks/"+t+"/components/"+n+"?lastmessageid="+o,callbackArgs:{originalRequest:e},callback:function(e,t){var n=JSON.parse(e);if(n.status&&"OK"===n.status&&n.Data&&n.Data.ComponentData&&n.Data.ComponentData.length>0)for(var a=n.Data.ComponentData,o=t.originalRequest.componentContainer.getElementsByClassName("messages-container")[0],s=0;s<a.length;s++){var r=ComponentInteractor.components.messaging.createMessageElement(a[s]);ElementHelper.prependChildElement({parentElement:o,childElement:r})}}})},1e4);this.intervals.push(t)},messageInputKeyPressEventHandler:function(e){if(EventHelper.isEnter(e)){var t=ElementHelper.findParentElementByClassName(e.target,"component-container"),n=t.getElementsByTagName("input")[0];ComponentInteractor.components.messaging.addMessage({messageInput:n,componentContainer:t})}},onSignOutEventHandler:function(e){for(;ComponentInteractor.components.messaging.intervals.length>0;){var t=ComponentInteractor.components.messaging.intervals.pop();clearInterval(t)}},Resources:{ERROR_SAVING_MESSAGE:"There was an error saving your message",MESSAGE:"Message"}},winloss:{key:"winloss",init:function(e){},createComponentElement:function(e){var t=document.createElement("span");return t.innerHTML="Record",BaseComponentInteractor.createComponentElement({key:this.key,itemId:e.itemId,componentData:e.componentData,componentType:e.componentType,headerTextElement:t,bodyElement:this.createBodyElement(e)})},createBodyElement:function(e){switch(e.componentType){case Constants.ComponentType.TASK_ADDON:return this.createItemAddonBodyElement(e);case Constants.ComponentType.TASK_LIST:return this.createItemListBodyElement(e);default:return}},createItemAddonBodyElement:function(e){var t=document.createElement("div"),n="winlossRadio"+e.itemId,a="win"+e.itemId,o=document.createElement("input");o.id=a,o.name=n,o.type="radio",o.value="1",o.onclick=this.winlossRadioClickEventHandler,o.checked=e.componentData.data&&e.componentData.data.State&&1===e.componentData.data.State;var s=document.createElement("label");s.htmlFor=a,s.innerHTML=this.Resources.WIN;var r="loss"+e.itemId,l=document.createElement("input");l.id=r,l.name=n,l.type="radio",l.value="2",l.onclick=this.winlossRadioClickEventHandler,l.checked=e.componentData.data&&e.componentData.data.State&&2===e.componentData.data.State;var i=document.createElement("label");i.htmlFor=r,i.innerHTML=this.Resources.LOSS;var m="draw"+e.itemId,c=document.createElement("input");c.id=m,c.name=n,c.type="radio",c.value="3",c.onclick=this.winlossRadioClickEventHandler,c.checked=e.componentData.data&&e.componentData.data.State&&3===e.componentData.data.State;var d=document.createElement("label");return d.htmlFor=m,d.innerHTML=this.Resources.DRAW,t.appendChild(o),t.appendChild(s),t.appendChild(l),t.appendChild(i),t.appendChild(c),t.appendChild(d),t},createItemListBodyElement:function(e){for(var t=0,n=0,a=0,o=0;o<e.componentData.data.length;o++)switch(e.componentData.data[o].State){case this.Constants.WIN:t++;break;case this.Constants.LOSS:n++;break;case this.Constants.DRAW:a++}var s=document.createElement("div");return s.className="record",s.innerHTML=t+" - "+n+" - "+a,s},addOrUpdateComponent:function(e){ElementHelper.addLoadingElement(e.componentContainer,this.Constants.LOADING_WINLOSS_ELEM_ID);var t=e.componentContainer.getAttribute(Constants.TASK_ID_ATTRIBUTE),n=e.componentContainer.getAttribute(Constants.COMPONENT_ID_ATTRIBUTE);AjaxHelper.postJsonRequest({url:Config.API_URL+"/tasks/"+t+"/components",content:{ComponentId:n,Data:{State:e.state}},callbackArgs:{componentContainer:e.componentContainer},callback:function(e,t){var n="winloss",a=JSON.parse(e);a.status&&"OK"===a.status?BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components[n].Resources.SAVED,isSuccess:!0}):BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components[n].Resources.ERROR,isSuccess:!1}),ElementHelper.removeLoadingElement(t.componentContainer,ComponentInteractor.components[n].Constants.LOADING_WINLOSS_ELEM_ID)}})},winlossRadioClickEventHandler:function(e){var t=ElementHelper.findParentElementByClassName(e.target,"component-container");ComponentInteractor.components.winloss.addOrUpdateComponent({state:e.target.value,componentContainer:t})},Constants:{WIN:1,LOSS:2,DRAW:3,LOADING_WINLOSS_ELEM_ID:"loading_component_winloss"},Resources:{ERROR:"There was an error saving your record",SAVED:"Record saved!",WIN:"Win",LOSS:"Loss",DRAW:"Draw"}},table:{key:"table",init:function(e){},createComponentElement:function(e){var t=document.createElement("span");return t.innerHTML=e.componentData.data.Name?e.componentData.data.Name:"Table",BaseComponentInteractor.createComponentElement({key:this.key,itemId:e.itemId,componentData:e.componentData,componentType:e.componentType,headerTextElement:t,bodyElement:this.createBodyElement(e)})},createBodyElement:function(e){var t=document.createElement("div");if(e.componentData.data){if(e.componentData.data.Rows&&e.componentData.data.Rows.length>0){var n=e.componentData.data.Rows,a=this.createTableElement(e.componentData.data.Id,n);t.appendChild(a)}}else{var o=document.createElement("span");o.innerHTML=this.Resources.NO_TABLE_DATA,t.appendChild(o)}return t},createTableElement:function(e,t){var n=UserInteractor.getUserSession(),a=document.createElement("table");a.setAttribute("table-id",e);for(var o=document.createElement("tbody"),s=document.createElement("tr"),r=0;r<t[0].Cells.length;r++){var l=document.createElement("th");l.innerHTML=t[0].Cells[r].Name,s.appendChild(l)}a.appendChild(s);for(r=0;r<t.length;r++){for(var s=document.createElement("tr"),i=0;i<t[r].Cells.length;i++){var m=document.createElement("td");if(n&&n.UserRole<=Constants.UserRole.ADMIN){var c=document.createElement("input");c.type="text",c.className="form-control add-item",c.value=t[r].Cells[i].Value?t[r].Cells[i].Value:"",c.onkeypress=this.tableCellKeyPressEventHandler,c.onblur=this.tableCellBlurEventHandler,c.setAttribute("row-id",t[r].Id),c.setAttribute("col-id",t[r].Cells[i].Id),m.appendChild(c)}else m.innerHTML=t[r].Cells[i].Value?t[r].Cells[i].Value:"&nbsp;";s.appendChild(m)}o.appendChild(s)}if(n&&n.UserRole<=Constants.UserRole.ADMIN){var d=document.createElement("input");d.value="1",d.type="text",d.className="form-control add-item";var E=document.createElement("button");E.innerHTML="Add Row(s)",E.className="btn btn-block btn-warning",E.setAttribute("table-id",e),E.onclick=this.addRowBtnClickEventHandler,(m=document.createElement("td")).setAttribute("colspan",t[0].Cells.length),m.appendChild(E),m.appendChild(d),(s=document.createElement("tr")).appendChild(m),o.appendChild(s)}return a.appendChild(o),a},addOrUpdateComponent:function(e){var t=e.componentContainer.getAttribute(Constants.TASK_ID_ATTRIBUTE),n=e.componentContainer.getAttribute(Constants.COMPONENT_ID_ATTRIBUTE);AjaxHelper.postJsonRequest({url:Config.API_URL+"/tasks/"+t+"/components",content:{ComponentId:n,Data:e.payload},callbackArgs:{componentContainer:e.componentContainer},callback:function(e,t){var n=JSON.parse(e);n.status&&"OK"===n.status?BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components.table.Resources.SAVED,isSuccess:!0}):BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components.table.Resources.ERROR,isSuccess:!1})}})},tableCellKeyPressEventHandler:function(e){if(EventHelper.isEnter(e)&&""!==e.target.value.trim()&&Number.isInteger(parseInt(e.target.value))){var t=ElementHelper.findParentElementByClassName(e.target,"component-container");ComponentInteractor.components.table.addOrUpdateComponent({componentContainer:t,payload:{Action:"Data",RowId:e.target.getAttribute("row-id"),ColId:e.target.getAttribute("col-id"),Value:parseInt(e.target.value)}})}},tableCellBlurEventHandler:function(e){if(""!==e.target.value.trim()&&Number.isInteger(parseInt(e.target.value))){var t=ElementHelper.findParentElementByClassName(e.target,"component-container");ComponentInteractor.components.table.addOrUpdateComponent({componentContainer:t,payload:{Action:"Data",RowId:e.target.getAttribute("row-id"),ColId:e.target.getAttribute("col-id"),Value:parseInt(e.target.value)}})}},addRowBtnClickEventHandler:function(e){if(""!==e.target.nextSibling.value.trim()&&Number.isInteger(parseInt(e.target.nextSibling.value))){var t=ElementHelper.findParentElementByClassName(e.target,"component-container");ComponentInteractor.components.table.addOrUpdateComponent({componentContainer:t,payload:{Action:"Rows",TableId:e.target.getAttribute("table-id"),RowCount:parseInt(e.target.nextSibling.value)}})}},Resources:{ERROR:"Error!",NO_TABLE_DATA:"no table data",SAVED:"Saved!"}},chart:{key:"chart",chartData:[],chartMetaData:[],init:function(e){document.addEventListener("onbindcomponentelement",this.onBindComponentElementEventHandler)},createComponentElement:function(e){var t=document.createElement("span");return t.innerHTML="Chart",BaseComponentInteractor.createComponentElement({key:this.key,itemId:e.itemId,componentData:e.componentData,componentType:e.componentType,headerTextElement:t,bodyElement:this.createBodyElement(e)})},createBodyElement:function(e){switch(e.componentType){case Constants.ComponentType.TASK_ADDON:return this.createItemAddonBodyElement(e);case Constants.ComponentType.TASK_LIST:return this.createItemListBodyElement(e)}},createItemAddonBodyElement:function(e){},createItemListBodyElement:function(e){if(0!==e.componentData.data.ChartData.length){var t=this.Constants.ITEM_LIST_CHART_KEY+e.itemId;this.chartData[t]=[];for(var n=[],a={},o=0;o<e.componentData.data.ChartData.length&&n.indexOf(e.componentData.data.ChartData[o].TaskId)<0;o++)n.push(e.componentData.data.ChartData[o].TaskId),a["yValue"+(o+1).toString()]={color:e.componentData.data.ChartData[o].ChartColor,name:e.componentData.data.ChartData[o].ChartAlias};a.itemCount=n.length,a.xAxisColNum=e.componentData.data.ChartData[0].XAxisColNum,a.yAxisColNum=e.componentData.data.ChartData[0].YAxisColNum,e.componentData.data.ChartData[0].XAxisName&&(a.xAxisName=e.componentData.data.ChartData[0].XAxisName),e.componentData.data.ChartData[0].YAxisName&&(a.yAxisName=e.componentData.data.ChartData[0].YAxisName),this.chartMetaData[t]=a;for(var s=1,r={},o=0;o<e.componentData.data.ChartData.length;o++)if(e.componentData.data.ChartData[o].RowOrder!==s&&(s=e.componentData.data.ChartData[o].RowOrder,this.chartData[t].push(r),r={}),e.componentData.data.ChartData[o].ColOrder===this.chartMetaData[t].xAxisColNum)r.xValue=e.componentData.data.ChartData[o].Value;else if(e.componentData.data.ChartData[o].ColOrder===this.chartMetaData[t].yAxisColNum){for(var l=0,i=0;i<n.length;i++)if(n[i]===e.componentData.data.ChartData[o].TaskId){l=i+1;break}r["yValue"+l]=e.componentData.data.ChartData[o].Value?e.componentData.data.ChartData[o].Value:0}this.chartData[t].push(r);var m=document.createElement("div");return m.className=Constants.CssClass.ITEM_LIST_COMPONENT,EventHelper.resizeEventHandlers[t]={},EventHelper.resizeEventHandlers[t].handler=this.drawChart,EventHelper.resizeEventHandlers[t].args={container:m,chartData:this.chartData[t],chartMetaData:this.chartMetaData[t]},m}},addOrUpdateComponent:function(e){var t=e.componentContainer.getAttribute(Constants.TASK_ID_ATTRIBUTE),n=e.componentContainer.getAttribute(Constants.COMPONENT_ID_ATTRIBUTE);AjaxHelper.postJsonRequest({url:Config.API_URL+"/tasks/"+t+"/components",content:{ComponentId:n,Data:e.payload},callbackArgs:{componentContainer:e.componentContainer},callback:function(e,t){var n=JSON.parse(e);n.status&&"OK"===n.status?BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components.chart.Resources.SAVED,isSuccess:!0}):BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components.chart.Resources.ERROR,isSuccess:!1})}})},drawChart:function(e,t){ElementHelper.clearChildElements({parentElement:t.container});var n={top:20,right:20,bottom:70,left:50},a=t.container.clientWidth-n.left-n.right-30,o=500-n.top-n.bottom,s=d3.select(t.container).append("svg").attr("width",a+n.left+n.right).attr("height",o+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),r=t.chartData;r.forEach(function(e){e.xValue=e.xValue.toString();for(var t=1;e.hasOwnProperty("yValue"+t);t++)e["yValue"+t]=+e["yValue"+t]});for(var l=d3.scaleLinear().range([0,a]),i=d3.scaleLinear().range([o,0]),m=d3.min(r,function(e){return e.xValue}),c=d3.max(r,function(e){return e.xValue}),d=d3.max(r,function(e){for(var t=[],n=1;e.hasOwnProperty("yValue"+n);n++)t.push(e["yValue"+n]);return Math.max.apply(null,t)}),E=[],p=[],u=0,C=m;C<=c;u++,C++)E[u]=C;for(var u=0,C=0;C<=d;u++,C++)p[u]=C;l.domain([m,c]),i.domain([0,d]);for(var I=a/t.chartMetaData.itemCount,u=1;t.chartMetaData.hasOwnProperty("yValue"+u);u++)s.append("path").data([r]).attr("class","line").style("stroke",t.chartMetaData["yValue"+u].color).attr("id","tag"+u).attr("d",function(e){return d3.line().x(function(e){return l(e.xValue)}).y(function(t){return i(t["yValue"+e])})}(u)),s.append("text").attr("x",I/3+(u-1)*I).attr("y",o+n.bottom-5).attr("class","legend").style("fill",t.chartMetaData["yValue"+u].color).text(t.chartMetaData["yValue"+u].name);s.append("g").attr("transform","translate(0,"+o+")").attr("class","axis").call(d3.axisBottom(l).tickValues(E)),s.append("g").attr("class","axis").call(d3.axisLeft(i).tickValues(p)),t.chartMetaData.xAxisName&&s.append("text").attr("transform","translate("+a/2+" ,"+(o+n.top+20)+")").attr("class","axis").style("text-anchor","middle").text(t.chartMetaData.xAxisName),t.chartMetaData.yAxisName&&s.append("text").attr("transform","rotate(-90)").attr("y",0-n.left).attr("x",0-o/2).attr("dy","1em").style("text-anchor","middle").attr("class","axis").text(t.chartMetaData.yAxisName)},onBindComponentElementEventHandler:function(e){if("chart"===e.detail.key&&e.detail.bindType===Constants.ComponentType.TASK_LIST){var t=ComponentInteractor.components.chart;t.drawChart(e,{container:e.detail.componentElement.getElementsByClassName(Constants.CssClass.ITEM_LIST_COMPONENT)[0],chartData:t.chartData[t.Constants.ITEM_LIST_CHART_KEY+e.detail.itemId],chartMetaData:t.chartMetaData[t.Constants.ITEM_LIST_CHART_KEY+e.detail.itemId]})}},Constants:{ITEM_LIST_CHART_KEY:"component-itemlist-chart-"},Resources:{ERROR:"Error!",SAVED:"Saved!"}},component:{key:"component",init:function(e){},createComponentElement:function(e){var t=document.createElement("span");return t.innerHTML="My Component",BaseComponentInteractor.createComponentElement({key:this.key,itemId:e.itemId,componentData:e.componentData,componentType:e.componentType,headerTextElement:t,bodyElement:this.createBodyElement(e)})},createBodyElement:function(e){switch(e.componentType){case Constants.ComponentType.TASK_ADDON:return this.createItemAddonBodyElement(e);case Constants.ComponentType.TASK_LIST:return this.createItemListBodyElement(e)}},createItemAddonBodyElement:function(e){var t=document.createElement("div");return t.innerHTML="Component Body",t},createItemListBodyElement:function(e){},addOrUpdateComponent:function(e){var t=e.componentContainer.getAttribute(Constants.TASK_ID_ATTRIBUTE),n=e.componentContainer.getAttribute(Constants.COMPONENT_ID_ATTRIBUTE);AjaxHelper.postJsonRequest({url:Config.API_URL+"/tasks/"+t+"/components",content:{ComponentId:n,Data:e.payload},callbackArgs:{componentContainer:e.componentContainer},callback:function(e,t){var n=JSON.parse(e);n.status&&"OK"===n.status?BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components.component.Resources.SAVED,isSuccess:!0}):BaseComponentInteractor.displayRequestActionResultMessage({parentElement:t.componentContainer.getElementsByClassName(Constants.CssClass.COMPONENT_HEADER)[0],message:ComponentInteractor.components.component.Resources.ERROR,isSuccess:!1})}})},Resources:{ERROR:"Error!",SAVED:"Saved!"}}}},NavBarInteractor={loadView:function(e){document.addEventListener("onsignin",this.onSignInEventHandler),document.addEventListener("onsignout",this.onSignOutEventHandler);var t=this.createRootElement();e.parent.appendChild(t)},createRootElement:function(){var e=this.createToggleNavElement(),t=this.createNavBrandElement(),n=document.createElement("sup");n.className="navbar-brand beta",n.innerHTML="BETA";var a=document.createElement("div");a.className="navbar-header",a.appendChild(e),a.appendChild(t);var o=this.createNavBarElement(),s=document.createElement("div");return s.className="container-fluid",s.appendChild(a),s.appendChild(o),(o=document.createElement("div")).className="navbar navbar-inverse navbar-fixed-top",o.appendChild(s),o},createToggleNavElement:function(){var e=document.createElement("span");e.className="sr-only",e.innerHTML="Toggle navigation";var t=document.createElement("span");t.className="icon-bar";var n=document.createElement("span");n.className="icon-bar";var a=document.createElement("span");a.className="icon-bar";var o=document.createElement("button");return o.className="navbar-toggle collapsed",o.type="button",o.setAttribute("data-toggle","collapse"),o.setAttribute("data-target","#navbar"),o.setAttribute("aria-expanded","false"),o.setAttribute("aria-controls","navbar"),o.appendChild(e),o.appendChild(t),o.appendChild(n),o.appendChild(a),o},createNavBrandElement:function(){document.createElement("p");var e=document.createElement("span"),t=document.createElement("span");e.innerHTML="WAZO",e.style.color="#dddddd",t.innerHTML="MILL",t.style.color="#fed136";var n=document.createElement("span");return n.className="navbar-brand",n.appendChild(e),n.appendChild(t),n},createNavBarElement:function(){var e=document.createElement("div");e.id=Constants.NAVBAR_ELEM_ID,e.className="collapse navbar-collapse";var t=UserInteractor.getUserSession();if(t&&!document.getElementById(Constants.SIGN_OUT_ELEM_ID)){var n=this.createSignOutElement(t);e.appendChild(n)}return e},createSignOutElement:function(e){var t=document.createElement("span");t.innerHTML="&times;";var n=document.createElement("button");n.type="button",n.title=Resources.SIGN_OUT,n.className="close",n.onclick=this.signOutClickEventHandler,n.appendChild(t);var a=document.createElement("div");return a.id=Constants.SIGN_OUT_ELEM_ID,a.className="nav navbar-nav navbar-right",a.appendChild(n),a},signOutClickEventHandler:function(e){UserInteractor.expireUserSession()},onSignInEventHandler:function(){var e=UserInteractor.getUserSession(),t=NavBarInteractor.createSignOutElement(e);ElementHelper.appendChildElement({parentElementId:Constants.NAVBAR_ELEM_ID,childElement:t})},onSignOutEventHandler:function(){ElementHelper.removeChildElement({parentElementId:Constants.NAVBAR_ELEM_ID,childElementId:Constants.SIGN_OUT_ELEM_ID})}},AssociationInteractor={currentAssociationId:0,init:function(){document.addEventListener("onsignin",this.onSignInEventHandler),document.addEventListener("onsignout",this.onSignOutEventHandler)},loadGlobalStyles:function(){document.body.style.paddingTop="50px"},loadView:function(e){this.getAssociationsRequest(e)},getAssociationsRequest:function(e){ElementHelper.addLoadingElement(e.parent,Constants.LOADING_ROOT_ELEM_ID);var t=UrlHelper.routes.has(Constants.ASSOCIATION_KEY_ATTRIBUTE)?"/associations/"+UrlHelper.routes.get(Constants.ASSOCIATION_KEY_ATTRIBUTE):"/associations",n=Config.API_URL+t;AjaxHelper.getJsonRequest({url:n,callback:this.getAssociationsRequestCallback,callbackArgs:e})},getAssociationsRequestCallback:function(e,t){ElementHelper.removeLoadingElement(t.parent,Constants.LOADING_ROOT_ELEM_ID);var n=JSON.parse(e);n?n&&n.status&&401===n.status?UserInteractor.authenticateUser():n.status&&200!==n.status?UserInteractor.expireUserSession():(Array.isArray(n)?t.associations=n:t.association=n,AssociationInteractor.loadAssociations(t)):alert(Resources.INVALID_PAGE)},loadAssociations:function(e){this.loadGlobalStyles();var t=document.getElementById(Constants.ASSOCIATION_VIEW_ELEM_ID);t&&ElementHelper.removeChildElement({parentElement:t.parentElement,childElement:t});var n=document.createElement("div");n.id=Constants.ASSOCIATION_VIEW_ELEM_ID,e.parent.appendChild(n);var a;e.associations?(a=this.createAssociationListElement(e.associations),this.currentAssociationId=e.associations[0].Id):(a=this.createAssociationElement(e.association),this.currentAssociationId=e.association.Id);var o=this.createAssociationContentElement();n.appendChild(a),n.appendChild(o),document.dispatchEvent(new CustomEvent("onloadassociation",{detail:{associationId:this.currentAssociationId}}))},createAssociationListElement:function(e){var t=document.createElement("select");t.id=Constants.ASSOCIATION_LIST_ELEM_ID,t.className="form-control associations-list",ElementHelper.clearSelectOptions({parentElement:t});for(var n=0;n<e.length;n++){var a=document.createElement("option");a.text=e[n].Name,a.value=e[n].Id,t.add(a)}var o=document.createElement("input");o.id=Constants.CURRENT_ASSOCIATION_ID_ELEM_ID,o.type="hidden",o.value="0";var s=document.createElement("div");return s.id=Constants.ASSOCIATION_LIST_CONTAINER_ELEM_ID,s.className="container-fluid associations-container",s.appendChild(t),s.appendChild(o),s},createAssociationElement:function(e){var t=document.createElement("div");t.className="association-item",t.innerHTML=e.Name;var n=document.createElement("div");return n.id=Constants.ASSOCIATION_LIST_CONTAINER_ELEM_ID,n.className="container-fluid associations-container",n.appendChild(t),n},createAssociationContentElement:function(){var e=document.createElement("div");e.id=Constants.ASSOCIATION_CONTENT_CONTAINER_ELEM_ID,e.className="row",e.appendChild(this.createDirectoriesContainer()),e.appendChild(this.createItemsContainer());var t=document.createElement("div");return t.className="container-fluid",t.appendChild(e),t},createDirectoriesContainer:function(){var e=document.createElement("ul");e.id=Constants.DIRECTORIES_CONTAINER_ELEM_ID,e.className="nav nav-pills flex-column";var t=document.createElement("div");t.className="nav-header",t.innerHTML=Resources.FOLDERS_HEADER;var n=document.createElement("nav");return n.className="col-sm-3 col-md-2 sidebar",n.appendChild(t),n.appendChild(e),n},createItemsContainer:function(){var e=document.createElement("div");e.id=Constants.TASK_CONTAINER_ELEM_ID,e.className="items-container";var t=document.createElement("main");return t.className="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main",t.appendChild(e),t},onSignInEventHandler:function(e){var t=document.getElementById("root");AssociationInteractor.getAssociationsRequest({parent:t})},onSignOutEventHandler:function(e){var t=document.getElementById(Constants.ASSOCIATION_VIEW_ELEM_ID);t&&ElementHelper.removeChildElement({parentElement:t.parentElement,childElement:t})}},DirectoryInteractor={currentDirectoryId:0,init:function(){document.addEventListener("onloadassociation",this.onLoadAssociationEventHandler)},getDirectoriesRequest:function(e){ElementHelper.addLoadingElement(e.parent,Constants.LOADING_DIRECTORIES_ELEM_ID),ElementHelper.appendChildElement({parentElement:e.parent,childElementType:"li",childElementText:Resources.LOADING_DIRECTORIES}),AjaxHelper.getJsonRequest({url:Config.API_URL+"/associations/"+e.associationId+"/directories",callback:this.getDirectoriesRequestCallback})},getDirectoriesRequestCallback:function(e){var t=document.getElementById(Constants.DIRECTORIES_CONTAINER_ELEM_ID);ElementHelper.clearChildElements({parentElement:t});var n=JSON.parse(e);n.status&&200!==n.status?ElementHelper.appendChildElement({parentElement:t,childElementType:"li",childElementText:Resources.ERROR_LOADING_DIRECTORIES}):DirectoryInteractor.loadDirectories({parentElement:t,directories:n})},loadDirectories:function(e){for(var t=0;t<e.directories.length;t++)ElementHelper.appendHyperlinkedChildElement({parentElement:e.parentElement,childElementType:"li",childElementText:e.directories[t].Name,childElementClass:"nav-item",linkElementClass:"nav-link"+(0===t?" active":""),link:""});this.currentDirectoryId=e.directories[0].Id,document.dispatchEvent(new CustomEvent("onloaddirectory",{detail:{directoryId:this.currentDirectoryId}}))},onLoadAssociationEventHandler:function(e){DirectoryInteractor.getDirectoriesRequest({parent:document.getElementById(Constants.DIRECTORIES_CONTAINER_ELEM_ID),associationId:e.detail.associationId})}},ItemInteractor={init:function(){document.addEventListener("onloaddirectory",this.onLoadDirectoryEventHandler)},getItemsRequest:function(e){ElementHelper.addLoadingElement(document.getElementById(Constants.TASK_CONTAINER_ELEM_ID).parentElement,Constants.LOADING_TASKS_LIST_ELEM_ID),AjaxHelper.getJsonRequest({url:Config.API_URL+"/directories/"+e.directoryId+"/tasks",callback:this.getItemsRequestCallback,callbackArgs:{directoryId:e.directoryId}})},getItemsRequestCallback:function(e,t){var n=document.getElementById(Constants.TASK_CONTAINER_ELEM_ID);ElementHelper.removeLoadingElement(n.parentElement,Constants.LOADING_TASKS_LIST_ELEM_ID);var a=JSON.parse(e);ItemInteractor.loadItems({directoryId:t.directoryId,parentElement:n,items:a.status&&200!==a.status?void 0:a})},addItemRequest:function(e){if(this.validateItemInput(e.addItemElem)){var t=GenericHelper.newGuid();this.addUnconfirmedItem(Constants.TASK_CONTAINER_ELEM_ID,e.addItemElem.value,t),AjaxHelper.postJsonRequest({url:Config.API_URL+"/tasks",content:{Name:e.addItemElem.value,DirectoryId:parseInt(e.addItemElem.getAttribute(Constants.DIRECTORY_ID_ATTRIBUTE))},callback:this.addItemRequestCallback,callbackArgs:{itemGuid:t,parentElement:document.getElementById(Constants.TASK_CONTAINER_ELEM_ID)}})}},addItemRequestCallback:function(e,t){var n=JSON.parse(e);if(n.status&&200!==n.status){var a=document.getElementById(t.itemGuid).getElementsByTagName("span")[0];a.innerHTML=Resources.ERROR_ADDING_ITEM,a.className="red"}else ItemInteractor.loadItem({parentElement:t.parentElement,item:n,loadComponents:!0,replaceItemId:t.itemGuid}),document.getElementsByClassName("add-item")[0].value=""},loadItemComponentsRequest:function(e){AjaxHelper.getJsonRequest({url:Config.API_URL+"/tasks/"+e.itemId+"/components",callback:this.loadItemComponentsRequestCallback,callbackArgs:{directoryId:e.directoryId,itemElement:e.itemElement}})},loadItemComponentsRequestCallback:function(e,t){var n=JSON.parse(e),a=document.createElement("div");if(a.id=Constants.TASK_COMPONENTS_CONTAINER_ELEM_ID_PREFIX+n.Data.TaskId,t.itemElement.parentElement.insertBefore(a,t.itemElement.nextSibling),n.Data.ComponentsData.length>0){for(var o=0;o<n.Data.ComponentsData.length;o++)if(ComponentInteractor.components[n.Data.ComponentsData[o].key]){var s=ComponentInteractor.components[n.Data.ComponentsData[o].key].createComponentElement({itemId:n.Data.TaskId,componentData:n.Data.ComponentsData[o],componentType:Constants.ComponentType.TASK_ADDON});s&&a.appendChild(s)}t.itemElement.setAttribute(Constants.COMPONENTS_LOADED_ATTRIBUTE,"true"),t.itemElement.classList.add(Constants.CssClass.COMPONENTS_EXPANDED);var r=t.itemElement.getElementsByClassName("fa-chevron-down")[0];r.className=r.className.replace("chevron-down","chevron-up")}},updateItemRequest:function(e){if(this.validateItemInput(e.updateItemElem))GenericHelper.newGuid()},loadItems:function(e){if(ElementHelper.clearChildElements({parentElement:e.parentElement}),e.items){var t=this.createNewItemElement({directoryId:e.directoryId,parentElement:e.parentElement.parentElement,maxLength:Constants.ADD_TASK_MAX_LENGTH}),n=document.createElement("div");if(e.parentElement.parentElement.insertBefore(n,e.parentElement.parentElement.firstChild),t&&e.parentElement.parentElement.insertBefore(t,n),this.loadItemListComponentsRequest({directoryId:e.directoryId,containerElement:n}),e.items.length>0)for(var a=0;a<e.items.length;a++){var o=0===a;this.loadItem({parentElement:e.parentElement,item:e.items[a],loadComponents:o})}else this.addItemsContainerMessage({parentElement:e.parentElement,id:Constants.NO_TASKS_ELEM_ID,message:Resources.NO_GAMES_TO_LOAD})}else this.addItemsContainerMessage({parentElement:e.parentElement,message:Resources.ERROR_LOADING_GAMES})},loadItem:function(e){var t=document.createElement("div");if(t.className="item-action col-xs-1",UserInteractor.getUserSession()){var n=ElementHelper.createIconElement("pencil");n.onclick=this.onUpdateItemClickEventHandler,t.appendChild(n)}var a=ElementHelper.createIconElement("chevron-down");a.onclick=this.toggleComponentsEventHandler,a.setAttribute(Constants.TASK_ID_ATTRIBUTE,e.item.Id),a.setAttribute(Constants.DIRECTORY_ID_ATTRIBUTE,e.item.DirectoryId),t.appendChild(a);var o=document.createElement("span");o.className="item-text",o.innerHTML=e.item.Name,o.ondblclick=this.onUpdateItemDblClickEventHandler,o.setAttribute(Constants.TASK_ID_ATTRIBUTE,e.item.Id);var s=document.createElement("div");s.className="col-xs-11",s.appendChild(o);var r=document.createElement("div");r.className="row",r.appendChild(s),r.appendChild(t);var l=document.createElement("div");l.className="item",l.setAttribute(Constants.COMPONENTS_LOADED_ATTRIBUTE,"false"),l.appendChild(r),e.replaceItemId?ElementHelper.replaceChildElement({newElement:l,childElementId:e.replaceItemId,parentElement:e.parentElement}):e.parentElement.appendChild(l),e.loadComponents&&this.loadItemComponentsRequest({itemId:e.item.Id,directoryId:e.item.DirectoryId,itemElement:l})},createNewItemElement:function(e){var t=UserInteractor.getUserSession();if(t&&t.UserRole<=Constants.UserRole.ADMIN){var n=document.createElement("input");return n.type="text",n.className="form-control add-item",n.placeholder=Resources.NEW_GAME,n.setAttribute(Constants.DIRECTORY_ID_ATTRIBUTE,e.directoryId),n.onkeypress=this.onAddItemKeyPressEventHandler,e.maxLength&&(n.maxLength=e.maxLength.toString()),n}},addItemsContainerMessage:function(e){ElementHelper.appendChildElement({parentElement:e.parentElement,childElementId:e.id?e.id:"",childElementType:"div",childElementText:e.message,childElementClass:Constants.CssClass.TASK_LIST_MESSAGE})},addUnconfirmedItem:function(e,t,n){var a=document.createElement("span");a.innerHTML=t;var o=document.createElement("div");o.id=n,o.className="item unconfirmed",o.appendChild(a),ElementHelper.prependChildElement({parentElementId:e,childElement:o})},updateItem:function(e,t,n){var a=(new DOMParser).parseFromString("<!doctype html><body>"+t,"text/html");ElementHelper.cancelActiveElements();var o=createTextInputElement({elementId:Constants.EDIT_TASK_ELEM_ID_PREFIX+e,elementClass:"form-control item update",elementValue:a.body.textContent,elementAttributes:[[Constants.TASK_ID_ATTRIBUTE,e]]});n.style.display="none",n.parentElement.insertBefore(o,n),o.onkeypress=this.onUpdateItemKeyPressEventHandler,o.focus(),n.className.indexOf(Constants.CssClass.COMPONENTS_EXPANDED)>=0&&o.classList.add(Constants.CssClass.COMPONENTS_EXPANDED),ElementHelper.cancelActiveElementDelegates.push(function(){ElementHelper.removeChildElement({parentElement:o.parentElement,childElement:o}),n.style.display=""})},toggleComponentsEventHandler:function(e){var t=e.target.getAttribute(Constants.TASK_ID_ATTRIBUTE),n=e.target.getAttribute(Constants.DIRECTORY_ID_ATTRIBUTE),a=ElementHelper.findParentElementByClassName(e.target,"item");if("true"==a.getAttribute(Constants.COMPONENTS_LOADED_ATTRIBUTE)){var o=a.nextSibling;""===o.style.display?(o.style.display="none",e.target.className=e.target.className.replace("chevron-up","chevron-down"),a.classList.remove(Constants.CssClass.COMPONENTS_EXPANDED)):(o.style.display="",e.target.className=e.target.className.replace("chevron-down","chevron-up"),a.classList.add(Constants.CssClass.COMPONENTS_EXPANDED))}else ItemInteractor.loadItemComponentsRequest({itemId:t,directoryId:n,itemElement:a})},loadItemListComponentsRequest:function(e){AjaxHelper.getJsonRequest({url:Config.API_URL+"/directories/"+e.directoryId+"/components",callback:this.loadItemListComponentsRequestCallback,callbackArgs:{directoryId:e.directoryId,containerElement:e.containerElement}})},loadItemListComponentsRequestCallback:function(e,t){for(var n=JSON.parse(e),a=0;a<n.Components.ComponentsData.length;a++)if(ComponentInteractor.components[n.Components.ComponentsData[a].key]){var o=ComponentInteractor.components[n.Components.ComponentsData[a].key].createComponentElement({itemId:n.Components.DirectoryId,componentData:n.Components.ComponentsData[a],componentType:Constants.ComponentType.TASK_LIST});o&&(t.containerElement.appendChild(o),document.dispatchEvent(new CustomEvent("onbindcomponentelement",{detail:{componentElement:o,itemId:n.Components.DirectoryId,bindType:Constants.ComponentType.TASK_LIST,key:n.Components.ComponentsData[a].key,componentData:n.Components.ComponentData}})))}},validateItemInput:function(e){return""!==e.value.trim()},onLoadDirectoryEventHandler:function(e){ItemInteractor.getItemsRequest({parent:document.getElementById(Constants.DIRECTORIES_CONTAINER_ELEM_ID),directoryId:e.detail.directoryId})},onAddItemKeyPressEventHandler:function(e){EventHelper.isEnter(e)&&ItemInteractor.addItemRequest({addItemElem:e.target})},onUpdateItemClickEventHandler:function(e){var t=e.target.parentElement.parentElement.getElementsByClassName("item-text")[0],n=t.getAttribute(Constants.TASK_ID_ATTRIBUTE),a=t.innerHTML;ItemInteractor.updateItem(n,a,ElementHelper.findParentElementByClassName(t,"item"))},onUpdateItemDblClickEventHandler:function(e){var t=e.target.getAttribute(Constants.TASK_ID_ATTRIBUTE),n=e.target.innerHTML;ItemInteractor.updateItem(t,n,ElementHelper.findParentElementByClassName(e.target,"item"))},onUpdateItemKeyPressEventHandler:function(e){var t=e.target.parentElement.parentElement.getElementsByClassName("item-text")[0];EventHelper.isEnter(e)&&e.target.value!==t.innerHTML&&ItemInteractor.updateItemRequest({updateItemElem:e.target})}},UrlHelper.init(window.location.href),UserInteractor.init(),AssociationInteractor.init(),DirectoryInteractor.init(),ItemInteractor.init(),ComponentInteractor.components.chart.init();var root=document.getElementById("root");NavBarInteractor.loadView({parent:root}),AssociationInteractor.loadView({parent:root}),document.onkeydown=function(e){EventHelper.isEsc(e)&&ElementHelper.cancelActiveElements()},window.onresize=function(e){for(var t in EventHelper.resizeEventHandlers)if(EventHelper.resizeEventHandlers.hasOwnProperty(t)){var n=EventHelper.resizeEventHandlers[t].args;(0,EventHelper.resizeEventHandlers[t].handler)(e,n)}};